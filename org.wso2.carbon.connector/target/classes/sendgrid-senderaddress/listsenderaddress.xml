<?xml version="1.0" encoding="UTF-8"?>

<template name="listsenderaddress" xmlns="http://ws.apache.org/ns/synapse">
    <parameter name="identity" description="Check for this particular Identity. (To list all Addresses on your account exclude this parameter)" />
    <sequence>
        <property name="uri.var.identity" expression="$func:identity" />

        <script language="js">
            <![CDATA[
            var jsonPayload = mc.getPayloadJSON();
            var identity = mc.getProperty('uri.var.identity');

            if (identity != null && identity != ""){
               jsonPayload.client.identity = identity;
            }
            mc.setPayloadJSON(jsonPayload);
         ]]>
        </script>
        
        <property name="messageType" value="application/x-www-form-urlencoded" scope="axis2" />

        <call>
            <endpoint>
                <http method="post" uri-template="{uri.var.apiUrl}/identity/list.json" />

            </endpoint>
        </call>
    </sequence>
</template>

<?xml version="1.0" encoding="UTF-8"?>

<template name="addsenderaddress" xmlns="http://ws.apache.org/ns/synapse">
    <parameter name="identity" description="Create an Address named this." />
    <parameter name="name" description="Specify the name to be used for this Address." />
    <parameter name="email" description="Specify the email address to be used for this Address." />
    <parameter name="replyto" description="Specify an email address to be used in the Reply-To field. If not defined, will default to the email parameter." />
    <parameter name="address" description="Specify the physical address to be used for this Address." />
    <parameter name="city" description="Specify the city to be used for this Address." />
    <parameter name="state" description="Specify the state to be used for this Address." />
    <parameter name="zip" description="Specify the zipcode/postal code to be used for this Address." />
    <parameter name="country" description="Specify the country to be used for this Address." />
    <sequence>
        <property name="uri.var.identity" expression="$func:identity" />
        <property name="uri.var.name" expression="$func:name" />
        <property name="uri.var.email" expression="$func:email" />
        <property name="uri.var.replyto" expression="$func:replyto" />
        <property name="uri.var.address" expression="$func:address" />
        <property name="uri.var.city" expression="$func:city" />
        <property name="uri.var.state" expression="$func:state" />
        <property name="uri.var.zip" expression="$func:zip" />
        <property name="uri.var.country" expression="$func:country" />

        <script language="js">
            <![CDATA[
            var jsonPayload = mc.getPayloadJSON();
            var replyto = mc.getProperty('uri.var.replyto');

            if (replyto != null && replyto != ""){
               jsonPayload.client.replyto = replyto;
            }
            mc.setPayloadJSON(jsonPayload);
         ]]>
        </script>

        <property name="messageType" value="application/x-www-form-urlencoded" scope="axis2" />

        <call>
            <endpoint>
                <http method="add" uri-template="{uri.var.apiUrl}/identity/add.json" />

            </endpoint>
        </call>
    </sequence>
</template>
